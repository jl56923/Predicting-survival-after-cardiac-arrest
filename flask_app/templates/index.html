<html>
<head>

  <script src="https://code.jquery.com/jquery-latest.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="/static/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">


  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.2.0/bootstrap-slider.min.js"></script>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.2.0/css/bootstrap-slider.min.css'/>

</head>
<body>

<script src="https://code.jquery.com/jquery-latest.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- specifically for fancy sliders, like fare -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.2.0/bootstrap-slider.min.js"></script>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.2.0/css/bootstrap-slider.min.css'/>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Use navbar just as a visual divider -->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark" style="position:fixed; top:0%; width:100%; z-index:950;">
    </nav>

    <div class="container" style="margin-top:30px; z-index: 900;">
      <div class="row">
        <!-- <div class="col-sm-3"> -->
        <div class="col-sm-3">
          <div id="stick_left" style="position: fixed; left: 0%; top: 0%; padding: 20px;">


          <h2>Probability of survival</h2>
          <hr class="d-sm-none">

          <div class="form-group" style="display: none" id='the_result_div'>
            <div>
              <br />
              You <span id="hard_predict"></span> survive.
              <br />
              Survival probability is <b><span id="soft_predict"></span>%</b>.
            </div>
          </div>
          </div>

          <div class="row">
            <div class="form-group col">
              <button id="submit" style="height: 50px; padding: 10px; position: fixed; bottom:0%; background-color: #166d99; opacity: 1;" onMouseOut="this.style.color='#a8fffd'"
   onMouseOver="this.style.color='#ffffff'">Make prediction</button>
            </div>
          </div>

        </div>

        <div class="col-sm-9">
          <h3>Demographics</h3>
          <div class="row">
              <div class="form-group col">
                <label for="sex_code"><h4><span class=" label label-primary">Gender</span></h4></label>
                <select id='sex_code' class="form-control input-lg">
                  <option value="sex_code_M">Male</option>
                  <option value="sex_code_F">Female</option>
                </select>
              </div>

              <div class="form-group col">
                <label for="pat_age"><h4><span class=" label label-primary">Age</span></h4></label>
                <select id='pat_age' class="form-control input-lg">
                  <option value="0">1-28 days</option>
                  <option value="1">29-365 days</option>
                  <option value="2">1-4 years</option>
                  <option value="3">5-9 years</option>
                  <option value="4">10-14 years</option>
                  <option value="5">15-17 years</option>
                  <option value="6">18-19 years</option>
                  <option value="7">20-24 years</option>
                  <option value="8">25-29 years</option>
                  <option value="9">30-34 years</option>
                  <option value="10">35-39 years</option>
                  <option value="11">40-44 years</option>
                  <option value="12">45-49 years</option>
                  <option value="13">50-54 years</option>
                  <option value="14" selected="selected">55-59 years</option>
                  <option value="15">60-64 years</option>
                  <option value="16">65-69 years</option>
                  <option value="17">70-74 years</option>
                  <option value="18">75-79 years</option>
                  <option value="19">80-84 years</option>
                  <option value="20">85-89 years</option>
                  <option value="21">90+ years</option>
                </select>
              </div>
          </div>

            <div class="row">

              <div class="form-group col">
                <label for="race"><h4><span class=" label label-primary">Race</span></h4></label>
                <select id='race' class="form-control input-lg">
                  <option value="race_1">American Indian/Eskimo/Aleut</option>
                  <option value="race_2">Asian or Pacific Islander</option>
                  <option value="race_3">Black</option>
                  <option value="race_4" selected="selected">White</option>
                  <option value="race_5">Other</option>
                </select>
              </div>

              <div class="form-group col">
                <label for="ethnicity"><h4><span class=" label label-primary">Ethnicity</span></h4></label>
                <select id='ethnicity' class="form-control input-lg">
                  <option value="ethnicity_1">Hispanic</option>
                  <option value="ethnicity_2" selected="selected">Not Hispanic</option>
                </select>
              </div>

            </div>

            <div class="row">

              <div class="form-group col">
                <label for="public_health_region"><h4><span class=" label label-primary">Region</span></h4></label>
                <select id='public_health_region' class="form-control input-lg">
                  <option value="public_health_region_01">Region 1</option>
                  <option value="public_health_region_02">Region 2</option>
                  <option value="public_health_region_03">Region 3</option>
                  <option value="public_health_region_04">Region 4</option>
                  <option value="public_health_region_05">Region 5</option>
                  <option value="public_health_region_06" selected="selected">Region 6</option>
                  <option value="public_health_region_07">Region 7</option>
                  <option value="public_health_region_08">Region 8</option>
                  <option value="public_health_region_09">Region 9</option>
                  <option value="public_health_region_10">Region 10</option>
                  <option value="public_health_region_11">Region 11</option>
                </select>
              </div>

              <div class="col">
                <img src="{{url_for('static', filename='PHR_Regions.gif')}}" height="250" width="250"/>
              </div>

            </div>

            <hr />

            <h3>Hospital stay</h3>

            <div class="row">

              <div class="form-group col">
                <label for="type_of_admission"><h4><span class=" label label-primary">Type of admission</span></h4></label>
                <select id="type_of_admission" class="form-control input-lg">
                  <option value="type_of_admission_1" selected="selected">Emergent</option>
                  <option value="type_of_admission_2">Urgent</option>
                  <option value="type_of_admission_3">Elective</option>
                </select>
              </div>

              <div class="form-group col">
                <label for="source_of_admission"><h4><span class=" label label-primary">Source of admission</span></h4></label>
                <select id="source_of_admission" class="form-control input-lg">
                  <option value="source_of_admission_1" selected="selected">Home</option>
                  <option value="source_of_admission_4">Transferred from another hospital</option>
                  <option value="source_of_admission_2">Referred from clinic</option>
                </select>
              </div>

              <div class="form-group col">
                <label for="hospital"><h4><span class=" label label-primary">Type of hospital</span></h4></label>
                <select id="hospital" class="form-control input-lg">
                  <option value="hospital_community" selected="selected">Community hospital</option>
                  <option value="hospital_teaching">Teaching hospital</option>
                  <option value="hospital_CAH">Rural hospital</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="form-group col">
                <label for="length_of_stay"><h4><span class=" label label-primary">Length of stay</span></h4></label>

                <input type="range" id="length_of_stay" min="1" max="30" step="1" value="1" class="form-control input-lg"/>
                <span>
                  Length of stay set to <span id='read_los'>1</span>
                </span>

              </div>

              <div class="form-group col">

                <label for="first_payment_src"><h4><span class=" label label-primary">Source of payment</span></h4></label>

                <select id="first_payment_src" class="form-control input-lg">
                  <option value="first_payment_src_MA" selected="selected">Medicare</option>
                  <option value="first_payment_src_09">Self pay</option>
                  <option value="first_payment_src_MC">Medicaid</option>
                  <option value="first_payment_src_16">HMO</option>
                  <option value="first_payment_src_12">PPO</option>
                </select>

              </div>
            </div>

            <hr />

            <h3>Medical conditions</h3>

            <div>
              <h4>Acute</h4>
              <ul>
                <li><input type="checkbox" class="dx" id="cb2" value="('5849', 'N')" />
                  <label for="cb2"><img src="{{url_for('static', filename='acute_kidney.png')}}" /><span style="margin:10px;">Acute kidney injury</span></label>
                  <!-- <span>Acute kidney injury</span> -->
                </li>
                <li><input type="checkbox" class="dx" id="cb1" value="('51881', 'N')"/>
                  <label for="cb1"><img src="{{url_for('static', filename='lungs.png')}}" /><span style="margin:10px;">Acute respiratory failure</span></label>
                  <!-- <span>Acute respiratory failure</span> -->
                </li>
                <li><input type="checkbox" class="dx" id="cb3" value="('3481', 'N')" />
                  <label for="cb3"><img src="{{url_for('static', filename='brain.png')}}" /><span style="margin:10px;">Anoxic brain injury</span></label>
                  <!-- <span>Anoxic brain injury</span> -->
                </li>
                <li><input type="checkbox" class="dx" id="cb7" value="('99592', 'N')" />
                  <label for="cb7"><img src="{{url_for('static', filename='germs.png')}}" /><span style="margin:10px;">Severe sepsis</span></label>
                  <!-- <span>Severe sepsis</span> -->
                </li>
              </ul>

              <h4>Chronic</h4>
              <ul>
                <li><input type="checkbox" class="dx" id="cb4" value="('41401', 'Y')"/>
                  <label for="cb4"><img src="{{url_for('static', filename='broken_heart.png')}}" /><span style="margin:10px;">Coronary artery disease</span></label>
                </li>
                <li><input type="checkbox" class="dx" id="cb8" value="('3051', 'Y')"/>
                  <label for="cb8"><img src="{{url_for('static', filename='cigarette.png')}}" /><span style="margin:10px;">Tobacco use</span></label>
                </li>
                <li><input type="checkbox" class="dx" id="cb5" value="('5856', 'Y')"/>
                  <label for="cb5"><img src="{{url_for('static', filename='ESRD.png')}}" /><span style="margin:10px;">End stage renal disease</span></label>
                </li>
                <li><input type="checkbox" class="dx" id="cb6" value="('25000', 'Y')"/>
                  <label for="cb6"><img src="{{url_for('static', filename='diabetes.png')}}" /><span style="margin:10px;">Diabetes</span></label>
                </li>

              </ul>
            </div>

            <!-- <div class="row">
              <div class="col">
              </div>
              <div class="form-group col">
                <button id="submit" style="height: 40px; position: fixed; bottom:0%; background-color: #393838; opacity: 1;">Make prediction</button>
              </div>
              <div class="col">
              </div>
            </div> -->

          </div>
        </div>

    </div>

  </body>

<script>
function send_features() {
  let features = {
    'sex_code': $('#sex_code').val(),
    'pat_age': +$('#pat_age').val(),
    'race': $('#race').val(),
    'ethnicity': $('#ethnicity').val(),
    'public_health_region': $('#public_health_region').val(),
    'first_payment_src': $('#first_payment_src').val(),
    'type_of_admission': $('#type_of_admission').val(),
    'source_of_admission': $('#source_of_admission').val(),
    'length_of_stay': +$('#length_of_stay').val(),
    'hospital': $("#hospital").val()
  }

  let dx_dict = {}
  let i = 0;
  $('.dx:checkbox:checked').each(function () {
       features['dx'+String(i++)] = $(this).val()
  });

  console.log(features)

  $.ajax({
    type: "POST",
    contentType: "application/json; charset=utf-8",
    url: "/predict",  // Replace with URL of POST handler
    dataType: "json",
    async: true,
    data: JSON.stringify(features),
    success: (result) => { /* AJAX has it built-in to recognize certain http statuses as success or failure */
      // $('#hard_predict').html(result['prediction'] ? 'will' : 'will not')
      // $('#soft_predict').html(result['prob_survived'])


      $('#hard_predict').html(result['prediction'] ? '<b>will</b>' : 'will <b>not</b>' );
      $('#soft_predict').html(Math.floor(result['prob_survived']*100000)/1000);
      $('#the_result_div').show();
    },
    error: (result) => {
      alert('Error')
    }
  })

}

$('#submit').click( () => { send_features(); });

$('#length_of_stay').change( () => {
    $('#read_los').html($('#length_of_stay').val());
  });

</script>
</html>
